%h2.mb-4
  Wallets
.row.mb-3
  .col-3
    %button#refresh
      Refresh
    %a{href: import_path, class: 'btn btn-primary'}
      Import
  .col-3
    = select_tag 'network', options_for_select(Network.where(user: current_user).pluck(:network_name, :chain_id), params[:chain_id].presence || 56), class: 'form-control mb-3'
.row
  .col-12
    %table.table.table-stripped
      %thead
        %tr
          %th Address
          %th Balance
          %th{style: 'width: 50px'} Actions
      %tbody
        - @wallets.each do |wallet|
          %tr
            %td
              = link_to wallet.address, wallet_path(wallet)
            %td
              = wallet.tokens.left_joins(:network).where('networks.chain_id = ?', params[:chain_id].presence || 56).sum(&:balance).ceil(2).to_s + ' USD'
            %td
              = link_to 'Delete', wallet_path(wallet), method: :delete, class: 'btn btn-danger', data: { confirm: 'Are you sure?' }
        %tr
          %td
          %td
            %strong
              = @total_balance.to_s + ' USD'

:javascript
  $('#network').on('change', function() {
    window.location.href = window.location.origin + window.location.pathname + '?chain_id=' + $(this).val()
  })

  $('#refresh').on('click', function() {
    $.ajax({
      url: '/refresh?chain_id=' + $('#network').val(),
      type: 'GET',
      async: true
    })
    alert('Refreshing')
  })
